ðŸ§  Your setup should be:

| EC2   | Role                   |
| ----- | ---------------------- |
| EC2-1 | Master (control plane) |
| EC2-2 | Worker                 |
| EC2-3 | Worker                 |

ðŸ”¥ STEP 1 â€” On ALL 3 EC2 instances (important)

Run:

sudo swapoff -a
sudo sed -i '/ swap / s/^/#/' /etc/fstab


Install containerd:

sudo apt update
sudo apt install -y containerd
sudo mkdir -p /etc/containerd
containerd config default | sudo tee /etc/containerd/config.toml


Edit:

sudo nano /etc/containerd/config.toml


Change:

SystemdCgroup = true


Restart:

sudo systemctl restart containerd
sudo systemctl enable containerd

ðŸ”¥ STEP 2 â€” On ALL 3 EC2 instances

Install kubeadm:

sudo apt update
sudo apt install -y apt-transport-https ca-certificates curl
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list
sudo apt update
sudo apt install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl

ðŸš€ STEP 3 â€” ONLY on MASTER EC2
sudo kubeadm init --pod-network-cidr=192.168.0.0/16


After success:

mkdir -p $HOME/.kube
sudo cp /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config


Install network:

kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/calico.yaml

ðŸ”— STEP 4 â€” Join workers

At end of kubeadm init youâ€™ll see something like:

kubeadm join <MASTER-IP>:6443 --token xxxx --discovery-token-ca-cert-hash sha256:xxxx


ðŸ‘‰ Run that command on BOTH worker EC2s.

âœ… Verify on master:
kubectl get nodes


You should see 3 nodes = Ready.
